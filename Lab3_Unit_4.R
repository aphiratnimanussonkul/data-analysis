#Unit 4 Decistion Tree and Random Forest
#?????????????????????????????? Decision Tree by package party
#ctree() => ) ????????????????????????????????????????????? Decision Tree ???????????????????????????????????????????????????????????? Species ??????????????????????????? iris 
# ????????????????????? ??? predict( ) ?????????????????????????????????????????????????????????????????????????????????????????? ??? specie ????????????
set.seed(1234)
#nrow ??????????????????????????? ??????????????????????????? iris
#ind ?????????????????????????????????????????????????????????????????????????????????????????? iris ?????? train, test ???????????????????????? 1, 2 
#prob ????????? ????????? % ?????????????????????????????????????????? 70:30
ind <- sample(2, nrow(iris), replace = TRUE, prob = c(0.7, 0.3))
#tranData ???????????????????????????????????? iris row ????????? ind = 1 
trainData <- iris[ind == 1, ]
testData <- iris[ind == 2, ]

# ????????????????????? ??? ctree( ) ???????????????????????????????????????????????? MinSplit, MinBusket, MaxSurrogate, MaxDepth ???????????????????????????????????????????????????
# ??????????????????????????????????????????13 ????????????????????????????????????????????????????????????????????????????????????????????????????????? ??? ?????? default

library(party)
myFormula <- Species  ~ Sepal.Length + Sepal.Width + Petal.Length + Petal.Width

iris_ctree <- ctree(myFormula, data = trainData)

table(predict(iris_ctree), trainData$Species)

print(iris_ctree)

plot(iris_ctree)

plot(iris_ctree, type="simple")

testPred <- predict(iris_ctree, newdata = testData)
table(testPred, testData$Species)
# ?????????????????????????????? ctree( ) ?????????????????????????????????????????????????????? missing value (?????? version 0.9-9995)

# ???????????????????????????????????????????????????????????? package rpart
# ??????????????????????????????????????????????????????????????????????????????????????????????????? ??? rpart( ) ??????????????????????????? ??? package rpart ?????????????????????????????????????????? Test ????????????
# ????????????????????? ??? predict( ) ??????????????????????????????????????????????????????????????? ??? bodyfat
titanic_train <- read.csv("C://cygwin64//home//AphiratNimanussonkul//data-analysis/titanic_train.csv")
titanic_test <- read.csv("C://cygwin64//home//AphiratNimanussonkul//data-analysis/titanic_test.csv")
titanic_train$Survived <- as.factor(titanic_train$Survived)
titanic_test$Survived <- as.factor(titanic_test$Survived)

library(rpart)
library(rpart.plot)

tree_fit <- rpart(Survived ~ ., data = titanic_train)
p <- predict(tree_fit, newdata = titanic_test, type = "class")
mean(p == titanic_test$Survived)

rpart.plot(tree_fit)


# ??????????????????????????????????????? Random Forest (????????????????????????????????????????????????)
# ??????????????????????????????????????? ??? randomForest( ) ????????? package randomForest
# ????????? ???????????????????????????????????????????????? ??? ????????????
# 1.??????????????????????????????????????????????????????????????????????????? ??? missing value (????????????????????????????????????????????? missing value??????????????? ????????????)
# 2. ????????????????????????????????????????????????????????????????????? categorical ?????????????????????????????????????????????????????? ??? ??????????????? 32 ????????? (???????????????????????? cforest( ) ????????? package party
#                                                                                   ?????????????????????????????????????????????????????????????????? ??????????????? ??? ???)
# ????????????????????????????????????????????????????????? iris ??????????????????????????????????????????????????????
library(party)
library(randomForest)

#create forest
output.forest <- randomForest(nativeSpeaker ~ age + shoeSize + score, data = readingSkills)

#view forest result
print(output.forest)

#importance of each predicter
print(importance(output.forest, type = 2))

      




